{"version":3,"sources":["file:///D:/course/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E7%BB%83%E4%B9%A0/2048/2048/assets/sprits/Score.ts"],"names":["_decorator","Component","Label","ccclass","property","Score","_presentScore","_highestScoreEver","onLoad","parseInt","localStorage","getItem","UpDataLabels","node","on","onScore","value","setItem","toString","presentScore","string","highestScoreEver","currentScore","bestScore","resetScore","start","update","deltaTime"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,K,OAAAA,K;;;;;;;;;OAC1B;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;;uBAGjBK,K,WADZF,OAAO,CAAC,OAAD,C,UAIHC,QAAQ,CAACF,KAAD,C,UAIRE,QAAQ,CAACF,KAAD,C,UAIRE,QAAQ,CAACF,KAAD,C,UAIRE,QAAQ,CAACF,KAAD,C,2BAhBb,MACaG,KADb,SAC2BJ,SAD3B,CACqC;AAAA;AAAA;;AAEjC;AAFiC;;AAMjC;AANiC;;AAUjC;AAViC;;AAcjC;AAdiC;;AAkBjC;AAlBiC,eAmBzBK,aAnByB,GAmBD,CAnBC;AAqBjC;AArBiC,eAsBzBC,iBAtByB,GAsBG,CAtBH;AAAA;;AAyBjC;AACUC,QAAAA,MAAM,GAAS;AACrB;AACA,eAAKD,iBAAL,GAAyBE,QAAQ,CAACC,YAAY,CAACC,OAAb,CAAqB,WAArB,KAAqC,GAAtC,CAAjC,CAFqB,CAGrB;;AACA,eAAKC,YAAL,GAJqB,CAKrB;;AACA,eAAKC,IAAL,CAAUC,EAAV,CAAa,OAAb,EAAsB,KAAKC,OAA3B,EAAoC,IAApC;AACH,SAjCgC,CAmCjC;;;AACOA,QAAAA,OAAO,CAACC,KAAD,EAAsB;AAChC;AACA,eAAKV,aAAL,IAAsBU,KAAtB,CAFgC,CAGhC;;AACA,cAAI,KAAKV,aAAL,GAAqB,KAAKC,iBAA9B,EAAiD;AAC7C,iBAAKA,iBAAL,GAAyB,KAAKD,aAA9B,CAD6C,CAE7C;;AACAI,YAAAA,YAAY,CAACO,OAAb,CAAqB,WAArB,EAAkC,KAAKV,iBAAL,CAAuBW,QAAvB,EAAlC;AACH,WAR+B,CAShC;;;AACA,eAAKN,YAAL;AACH,SA/CgC,CAiDjC;;;AACQA,QAAAA,YAAY,GAAS;AACzB,cAAI,KAAKO,YAAT,EAAuB;AACnB,iBAAKA,YAAL,CAAkBC,MAAlB,GAA2B,KAAKd,aAAL,CAAmBY,QAAnB,EAA3B;AACH;;AACD,cAAI,KAAKG,gBAAT,EAA2B;AACvB,iBAAKA,gBAAL,CAAsBD,MAAtB,GAA+B,KAAKb,iBAAL,CAAuBW,QAAvB,EAA/B;AACH;;AACD,cAAI,KAAKI,YAAT,EAAuB;AACnB,iBAAKA,YAAL,CAAkBF,MAAlB,GAA2B,KAAKd,aAAL,CAAmBY,QAAnB,EAA3B;AACH;;AACD,cAAI,KAAKK,SAAT,EAAoB;AAChB,iBAAKA,SAAL,CAAeH,MAAf,GAAwB,KAAKb,iBAAL,CAAuBW,QAAvB,EAAxB;AACH;AACJ,SA/DgC,CAiEjC;;;AACOM,QAAAA,UAAU,GAAS;AACtB,eAAKlB,aAAL,GAAqB,CAArB;AACA,eAAKM,YAAL;AACH;;AAEDa,QAAAA,KAAK,GAAG,CAAG;;AACXC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAAG;;AAxEI,O;;;;;iBAIX,I;;;;;;;iBAII,I;;;;;;;iBAIJ,I;;;;;;;iBAIH,I","sourcesContent":["import { _decorator, Component, Label, Node } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Score')\r\nexport class Score extends Component {\r\n\r\n    // 游戏中实时显示的“当前得分”标签\r\n    @property(Label)\r\n    presentScore: Label = null;\r\n\r\n    // 游戏中实时显示的“历史最高分”标签\r\n    @property(Label)\r\n    highestScoreEver: Label = null;\r\n\r\n    // 游戏结束界面显示的“本局分数”标签\r\n    @property(Label)\r\n    currentScore: Label = null;\r\n\r\n    // 游戏结束界面显示的“历史最佳分数”标签\r\n    @property(Label)\r\n    bestScore: Label = null;\r\n\r\n    // 当前局内得分（内存变量）\r\n    private _presentScore: number = 0;\r\n\r\n    // 历史最高分（从本地存储读取）\r\n    private _highestScoreEver: number = 0;\r\n\r\n\r\n    // 组件加载时触发：读取存档、初始化显示、注册得分事件\r\n    protected onLoad(): void {\r\n        // 从浏览器本地存储读取历史最高分，不存在则默认为 0\r\n        this._highestScoreEver = parseInt(localStorage.getItem('bestScore') || '0');\r\n        // 同步所有 Label 的初始文字\r\n        this.UpDataLabels();\r\n        // 监听同节点发出的自定义事件 'score'，收到后调用 onScore 方法\r\n        this.node.on('score', this.onScore, this);\r\n    }\r\n\r\n    // 得分事件回调：value 为合并后新生成的数字（如 4、8、16...）\r\n    public onScore(value: number): void {\r\n        // 累加到当前局内得分\r\n        this._presentScore += value;\r\n        // 如果突破历史最高分，则更新并持久化\r\n        if (this._presentScore > this._highestScoreEver) {\r\n            this._highestScoreEver = this._presentScore;\r\n            // 写入浏览器本地存储，key 为 'bestScore'\r\n            localStorage.setItem('bestScore', this._highestScoreEver.toString());\r\n        }\r\n        // 刷新所有相关 Label 的显示\r\n        this.UpDataLabels();\r\n    }\r\n\r\n    // 统一刷新四个 Label 的显示文字\r\n    private UpDataLabels(): void {\r\n        if (this.presentScore) {\r\n            this.presentScore.string = this._presentScore.toString();\r\n        }\r\n        if (this.highestScoreEver) {\r\n            this.highestScoreEver.string = this._highestScoreEver.toString();\r\n        }\r\n        if (this.currentScore) {\r\n            this.currentScore.string = this._presentScore.toString();\r\n        }\r\n        if (this.bestScore) {\r\n            this.bestScore.string = this._highestScoreEver.toString();\r\n        }\r\n    }\r\n\r\n    // 重新开始时重置当前局内得分并刷新显示\r\n    public resetScore(): void {\r\n        this._presentScore = 0;\r\n        this.UpDataLabels();\r\n    }\r\n\r\n    start() { }\r\n    update(deltaTime: number) { }\r\n}\r\n\r\n\r\n"]}