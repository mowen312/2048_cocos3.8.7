{"version":3,"sources":["file:///D:/course/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E7%BB%83%E4%B9%A0/2048/2048/assets/sprits/Grid.ts"],"names":["_decorator","Color","Component","Label","Sprite","tween","UITransform","Vec3","ccclass","property","Grid","_sprite","_uiTransform","_label","_value","_canContorl","onLoad","node","getComponent","gridNumberNode","getChildByName","setSize","width","height","setContentSize","setValue","value","animate","oldValue","string","toString","digitCount","length","fontSize","UpdateColor","playSpawnAnimation","playMergeAnimation","colorMap","color","getValue","setControl","getCanControl","playMoveAnimation","targetPos","duration","to","position","easing","start","setScale","scale","update","deltaTime"],"mappings":"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","sourcesContent":["/*\r\n    0.02版说明：包含三种动画（生成、合并、移动）\r\n*/\r\n// 导入Cocos Creator引擎相关模块\r\nimport { _decorator, AudioClip, Color, Component, Label, Node, Sprite, tween, UITransform, Vec3 } from 'cc';\r\n// 注册组件，允许在编辑器中使用\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Grid')\r\nexport class Grid extends Component {\r\n    // 格子背景精灵组件（用于显示颜色）\r\n    private _sprite: Sprite = null;\r\n    // UI变换组件（用于控制大小和位置）\r\n    private _uiTransform: UITransform = null;\r\n    // 数字标签组件（用于显示格子上的数值）\r\n    private _label: Label = null;\r\n    // 格子当前的数值（如2、4、8等）\r\n    private _value: number = 0;\r\n    // 标记格子是否可被控制（预留功能）\r\n    private _canContorl: boolean = false;\r\n\r\n    // 组件加载时调用（初始化）\r\n    protected onLoad(): void {\r\n        // 获取精灵组件引用（用于设置背景颜色）\r\n        this._sprite = this.node.getComponent(Sprite);\r\n        // 获取UI变换组件引用（用于设置大小）\r\n        this._uiTransform = this.node.getComponent(UITransform);\r\n        // 获取子节点\"GridNumber\"上的标签组件（用于显示数字）\r\n        const gridNumberNode = this.node.getChildByName(\"GridNumber\");\r\n        this._label = gridNumberNode.getComponent(Label);\r\n    }\r\n\r\n    // 设置格子的大小\r\n    public setSize(width: number, height: number) {\r\n        // 如果UI变换组件存在，设置其宽高\r\n        if (this._uiTransform) {\r\n            this._uiTransform.setContentSize(width, height);\r\n        }\r\n    }\r\n\r\n    // 设置格子的数值，animate参数控制是否播放动画\r\n    public setValue(value: number, animate: boolean = false) {\r\n        // 记录旧值，用于判断是否需要播放动画\r\n        const oldValue = this._value;\r\n        // 更新当前值\r\n        this._value = value;\r\n        // 如果标签组件存在，设置显示文本（0不显示）\r\n        if (this._label) {\r\n            this._label.string = value > 0 ? value.toString() : '';\r\n        }\r\n\r\n        // 根据数值的位数调整字体大小（避免数字溢出）\r\n        if (value > 0) {\r\n            const digitCount = value.toString().length; // 获取数字的位数\r\n            switch (digitCount) {\r\n                case 1:\r\n                    this._label.fontSize = 130;\r\n                    break;\r\n                case 2:\r\n                    this._label.fontSize = 96.5;\r\n                    break;\r\n                case 3:\r\n                    this._label.fontSize = 69.2;\r\n                    break;\r\n                case 4:\r\n                    this._label.fontSize = 55.6;\r\n                    break;\r\n                default:\r\n                    this._label.fontSize = 10; // 超过4位的特殊处理\r\n            }\r\n        } else {\r\n            this._label.fontSize = 0; // 0值时隐藏文字\r\n        }\r\n\r\n        // 更新格子的颜色（背景和文字）\r\n        this.UpdateColor();\r\n\r\n        // 动画逻辑：根据数值变化判断是否播放动画\r\n        if (animate) {\r\n            // 新生成格子（从0变为有值）\r\n            if (oldValue === 0 && value > 0) {\r\n                this.playSpawnAnimation();\r\n            } \r\n            // 合并格子（值变大且旧值不为0）\r\n            else if (value > oldValue && oldValue > 0) {\r\n                this.playMergeAnimation();\r\n            }\r\n        }\r\n    }\r\n\r\n    // 更新格子的背景颜色和文字颜色\r\n    private UpdateColor() {\r\n        // 如果精灵组件不存在，直接返回\r\n        if (!this._sprite) return;\r\n\r\n        // 定义不同数值对应的背景颜色映射表\r\n        const colorMap: { [key: number]: Color } = {\r\n            0: new Color(205, 193, 180), // 空格子颜色\r\n            2: new Color(238, 228, 218),\r\n            4: new Color(237, 224, 200),\r\n            8: new Color(242, 177, 121),\r\n            16: new Color(245, 149, 99),\r\n            32: new Color(246, 124, 95),\r\n            64: new Color(246, 94, 59),\r\n            128: new Color(237, 207, 114),\r\n            256: new Color(237, 204, 97),\r\n            512: new Color(237, 200, 80),\r\n            1024: new Color(237, 197, 63),\r\n            2048: new Color(237, 194, 46)\r\n        };\r\n\r\n        // 设置背景颜色（如果没有对应数值的颜色，默认用空格子颜色）\r\n        this._sprite.color = colorMap[this._value] || colorMap[0];\r\n\r\n        // 设置文字颜色（数值>=8用白色，否则用黑色，增强对比度）\r\n        this._label.color = this._value >= 8 ? new Color(249, 246, 242) : new Color(119, 110, 101);\r\n    }\r\n\r\n    // 获取当前格子的数值\r\n    public getValue(): number {\r\n        return this._value;\r\n    }\r\n\r\n    // 设置格子是否可被控制（预留功能）\r\n    public setControl(_canContorl: boolean) {\r\n        this._canContorl = _canContorl;\r\n    }\r\n\r\n    // 获取格子是否可被控制的状态（预留功能）\r\n    public getCanControl(): boolean {\r\n        return this._canContorl;\r\n    }\r\n\r\n    // === 动画相关方法 ===\r\n\r\n    // 播放移动动画（从当前位置移动到目标位置）\r\n    public playMoveAnimation(targetPos: Vec3, duration: number = 2.0) {\r\n        // 使用tween创建缓动动画：在指定时间内移动到目标位置\r\n        tween(this.node)\r\n            .to(duration, { position: targetPos }, { easing: 'quadOut' }) // quadOut缓动：先快后慢，更自然\r\n            .start(); // 启动动画\r\n    }\r\n\r\n    // 播放新生成格子的动画（缩放弹出效果）\r\n    public playSpawnAnimation() {\r\n        // 初始状态：缩放到0（不可见）\r\n        this.node.setScale(new Vec3(0, 0, 1));\r\n        // 动画序列：先放大到1.1倍（0.15秒），再缩小到1倍（0.1秒）\r\n        tween(this.node)\r\n            .to(0.15, { scale: new Vec3(1.1, 1.1, 1) }) // 放大阶段\r\n            .to(0.1, { scale: new Vec3(1, 1, 1) }) // 恢复阶段\r\n            .start(); // 启动动画\r\n    }\r\n\r\n    // 播放合并动画（放大后恢复效果）\r\n    public playMergeAnimation() {\r\n        // 动画序列：先放大到1.2倍（0.1秒），再缩小到1倍（0.1秒）\r\n        tween(this.node)\r\n            .to(0.1, { scale: new Vec3(1.2, 1.2, 1) }) // 放大强调合并\r\n            .to(0.1, { scale: new Vec3(1, 1, 1) }) // 恢复正常大小\r\n            .start(); // 启动动画\r\n    }\r\n\r\n    // 组件启动时调用（空实现，预留）\r\n    start() { }\r\n\r\n    // 每帧更新（空实现，预留）\r\n    update(deltaTime: number) { }\r\n}\r\n"]}