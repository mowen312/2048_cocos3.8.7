{"version":3,"sources":["file:///D:/course/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E7%BB%83%E4%B9%A0/2048/2048/assets/sprits/Swipe.ts"],"names":["_decorator","AudioClip","Component","Node","Vec2","AudioMgr","ccclass","property","SwipeDirection","Swipe","startPos","isSwiping","onLoad","node","on","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","onTouchCancel","console","log","event","getLocation","currentPos","deltaX","x","deltaY","y","endPos","distance","Math","sqrt","toFixed","direction","None","minSwipeDistance","abs","Right","Left","Up","Down","getDirectionText","emitSwipeEvent","clickAudio","inst","playOneShot","chessboardNode","emit","warn","onDestroy","off"],"mappings":"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","sourcesContent":["import { _decorator, AudioClip, Component, EventTouch, Node, Vec2 } from 'cc';\r\nimport { AudioMgr } from './AudioMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\nenum SwipeDirection {\r\n    Up,\r\n    Down,\r\n    Left,\r\n    Right,\r\n    None\r\n}\r\n\r\n@ccclass('Swipe')\r\nexport class Swipe extends Component {\r\n    @property\r\n    minSwipeDistance: number = 0; // 滑动阈值\r\n\r\n    @property(Node)\r\n    chessboardNode: Node = null;\r\n\r\n     // 声明音频资源属性\r\n    @property(AudioClip)\r\n    clickAudio:AudioClip = null;\r\n\r\n    private startPos: Vec2 = new Vec2(0, 0);\r\n    private isSwiping: boolean = false; // 标记是否正在滑动\r\n\r\n    protected onLoad() {\r\n        // 注册触摸事件\r\n        this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n        this.node.on(Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchCancel, this);\r\n        console.log(\"Swipe组件初始化，已注册触摸事件\"); // 初始化日志\r\n    }\r\n\r\n    protected onTouchStart(event: EventTouch) {\r\n        this.startPos = event.getLocation();\r\n        this.isSwiping = false;\r\n        // 触摸开始日志，打印起始位置\r\n       // console.log(`触摸开始 - 位置: (${this.startPos.x.toFixed(0)}, ${this.startPos.y.toFixed(0)})`);\r\n        console.log(\"触摸开始\");\r\n    }\r\n\r\n    protected onTouchMove(event: EventTouch) {\r\n        this.isSwiping = true;\r\n        const currentPos = event.getLocation();\r\n        const deltaX = currentPos.x - this.startPos.x;\r\n        const deltaY = currentPos.y - this.startPos.y;\r\n        // 触摸移动日志，打印当前位置和偏移量\r\n        //console.log(`触摸移动 - 当前位置: (${currentPos.x.toFixed(0)}, ${currentPos.y.toFixed(0)}) | 偏移: (${deltaX.toFixed(0)}, ${deltaY.toFixed(0)})`);\r\n    }\r\n\r\n    protected onTouchEnd(event: EventTouch) {\r\n        const endPos = event.getLocation();\r\n        const deltaX = endPos.x - this.startPos.x;\r\n        const deltaY = endPos.y - this.startPos.y;\r\n        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\r\n        \r\n        // 触摸结束基础信息日志\r\n        console.log(`触摸结束 - 结束位置: (${endPos.x.toFixed(0)}, ${endPos.y.toFixed(0)}) | 总偏移: (${deltaX.toFixed(0)}, ${deltaY.toFixed(0)}) | 滑动距离: ${distance.toFixed(0)}`);\r\n\r\n        let direction: SwipeDirection = SwipeDirection.None;\r\n        // 滑动距离达标且有移动行为，才判定为有效滑动\r\n        if (this.isSwiping && distance >= this.minSwipeDistance) {\r\n            if (Math.abs(deltaX) > Math.abs(deltaY)) {\r\n                direction = deltaX > 0 ? SwipeDirection.Right : SwipeDirection.Left;\r\n            } else {\r\n                direction = deltaY > 0 ? SwipeDirection.Up : SwipeDirection.Down;\r\n            }\r\n            // 有效滑动方向日志\r\n            console.log(`有效滑动 - 方向: ${this.getDirectionText(direction)}`);\r\n        } else {\r\n            // 无效滑动日志\r\n            console.log(`无效滑动 - 距离不足或未移动 (阈值: ${this.minSwipeDistance})`);\r\n        }\r\n\r\n        this.emitSwipeEvent(direction);\r\n        this.isSwiping = false;\r\n    }\r\n\r\n    protected onTouchCancel(event: EventTouch) {\r\n        this.isSwiping = false;\r\n        console.log(\"触摸取消 - 触摸事件被中断\"); // 触摸取消日志\r\n    }\r\n\r\n    private emitSwipeEvent(direction: SwipeDirection) {\r\n         // 播放滑动音效（方向有效才播）\r\n        if (direction !== SwipeDirection.None && this.clickAudio) {\r\n            AudioMgr.inst.playOneShot(this.clickAudio);\r\n        }\r\n\r\n        if (this.chessboardNode) {\r\n            this.chessboardNode.emit('swipe', direction);\r\n            console.log(`已向棋盘发送滑动事件 - 方向: ${this.getDirectionText(direction)}`); // 事件发送日志\r\n        } else {\r\n            console.warn(\"未设置chessboardNode，无法发送滑动事件\"); // 警告日志\r\n        }\r\n    }\r\n\r\n    // 辅助方法：将方向枚举转为文本\r\n    private getDirectionText(direction: SwipeDirection): string {\r\n        switch(direction) {\r\n            case SwipeDirection.Up: return \"上\";\r\n            case SwipeDirection.Down: return \"下\";\r\n            case SwipeDirection.Left: return \"左\";\r\n            case SwipeDirection.Right: return \"右\";\r\n            default: return \"无\";\r\n        }\r\n    }\r\n\r\n    protected onDestroy() {\r\n        // 移除事件监听，避免内存泄漏\r\n        this.node.off(Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n        this.node.off(Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.node.off(Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.node.off(Node.EventType.TOUCH_CANCEL, this.onTouchCancel, this);\r\n        console.log(\"Swipe组件销毁，已移除触摸事件监听\"); // 销毁日志\r\n    }\r\n}\r\n"]}