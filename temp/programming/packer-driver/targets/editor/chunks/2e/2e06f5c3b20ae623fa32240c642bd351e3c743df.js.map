{"version":3,"sources":["file:///D:/course/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/%E7%BB%83%E4%B9%A0/2048/2048/assets/sprits/GameManager.ts"],"names":["_decorator","Component","Grid","Chessboard","GameReadyUI","GameOverUI","Score","ccclass","property","GameState","GameManager","type","curGS","Ready","inst","_insc","onLoad","chessboard","node","on","value","score","getComponent","onScore","start","transitionToReadyState","evt","GameOver","has2048","gameReadyUI","EnableGameReadyUI","gameOverUI","DisableGameOverUI","setSwipeEnable","StartGame","Gaming","isSuccess","EnableGameOverUI","DisableGameReadyUI","PlayAgain","initChessboard","resetScore","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { Grid } from './Grid';\r\n// import { Chessboard } from './Chessboard';\r\nimport { Chessboard } from './Chessboard';\r\nimport { GameReadyUI } from './UI/GameReadyUI';\r\nimport { GameOverUI } from './UI/GameOverUI';\r\nimport { Score } from './Score';\r\nconst { ccclass, property } = _decorator;\r\n\r\nenum GameState{\r\n    // 游戏状态\r\n    Ready,\r\n    Gaming,\r\n    GameOver\r\n}\r\n\r\n@ccclass('GameManager')\r\nexport class GameManager extends Component {\r\n    // 单例模式\r\n    // 静态变量，存储 GameManager 的唯一实例\r\n    private static _insc:GameManager = null;\r\n    \r\n    \r\n\r\n    // 导入组件\r\n    @property(Grid)\r\n    grid:Grid = null;\r\n\r\n    // @property(Chessboard)\r\n    // chessboard: Chessboard = null;\r\n\r\n    @property({ type: Chessboard }) \r\n    public chessboard: Chessboard | null = null;\r\n\r\n    @property(GameReadyUI)\r\n    gameReadyUI:GameReadyUI = null;\r\n\r\n    @property(GameOverUI)\r\n    gameOverUI: GameOverUI = null;\r\n\r\n    curGS: GameState = GameState.Ready;\r\n\r\n    // 静态方法，提供全局访问实例的入口\r\n    public static inst(){\r\n        return this._insc;\r\n    }\r\n\r\n    onLoad() {\r\n        GameManager._insc = this;\r\n\r\n        // 监听棋盘得分事件\r\n        if (this.chessboard) {\r\n            this.chessboard.node.on('score', (value: number) => {\r\n                const score = this.node.getComponent(Score);\r\n                if (score) {\r\n                    score.onScore(value); // 直接调用得分逻辑\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\nprotected start(): void {\r\n    this.transitionToReadyState();\r\n\r\n     if (this.chessboard && this.chessboard.node) {\r\n        this.chessboard.node.on('game-over', (evt: { has2048?: boolean }) => {\r\n            this.GameOver(evt?.has2048);\r\n        }, this);\r\n    }\r\n}\r\n\r\n    transitionToReadyState(){\r\n        this.curGS = GameState.Ready;\r\n        // 启用ui\r\n        if(this.gameReadyUI){\r\n            this.gameReadyUI.EnableGameReadyUI();\r\n        }\r\n\r\n        if(this.gameOverUI){\r\n            this.gameOverUI.DisableGameOverUI();\r\n        }\r\n\r\n\r\n        // 初始禁用滑动\r\n        if ( this.chessboard ){\r\n            this.chessboard.setSwipeEnable(false);\r\n        }\r\n    }\r\n\r\n    StartGame(){\r\n        this.curGS = GameState.Gaming;\r\n\r\n        // 启用滑动\r\n        if( this.chessboard ){\r\n            this.chessboard.setSwipeEnable(true);\r\n        }\r\n    }\r\n\r\n\r\n    GameOver(isSuccess: boolean = false){\r\n        this.curGS = GameState.GameOver;\r\n\r\n        // 启用ui，传递是否成功的状态\r\n        if(this.gameOverUI){\r\n            this.gameOverUI.EnableGameOverUI(isSuccess);\r\n        }\r\n\r\n        if(this.gameReadyUI){\r\n            this.gameReadyUI.DisableGameReadyUI();\r\n        }\r\n\r\n        // 禁用滑动\r\n        if(this.chessboard){\r\n            this.chessboard.setSwipeEnable(false);\r\n        }\r\n    }\r\n\r\n    PlayAgain(){\r\n        if(Chessboard){\r\n            this.chessboard.initChessboard();\r\n            this.chessboard.setSwipeEnable(true);\r\n        }\r\n\r\n        const score = this.node.getComponent(Score);\r\n        if (score) score.resetScore();\r\n    }\r\n\r\n\r\n    update(deltaTime: number) {\r\n        \r\n    }\r\n}\r\n\r\n\r\n// function type(arg0: string): (target: GameManager, propertyKey: \"chessboard\") => void {\r\n//     throw new Error('Function not implemented.');\r\n// }\r\n\r\n"]}